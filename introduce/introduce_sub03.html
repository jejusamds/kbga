<?php
        $Menu = "01";
        $sMenu = "01-3";

        include $_SERVER['DOCUMENT_ROOT'].'/include/header.html';

        // 협력기관 및 관리기관 목록 불러오기
        $cooperates = $db->query("SELECT * FROM df_site_agency WHERE f_type='cooperate' ORDER BY f_order ASC");
        $manages    = $db->query("SELECT * FROM df_site_agency WHERE f_type='manage' ORDER BY f_order ASC");
?>

	<div id="container">
		<div id="sub_con">
			<?php
				include $_SERVER['DOCUMENT_ROOT'].'/include/sub_banner.html'; 
			?>

			<div class="contents_con">
				
				<div class="introduce_sub03_con">
					<div class="info01_con">
						<div class="contents_con">
							<div class="title_con">
								<div class="text01_con">
									<span>
										COOPERATIVE ORGANIZATION
									</span>
								</div>

								<div class="text02_con">
									<span>
										협력기관
									</span>
								</div>
							</div>

                                                        <div class="contents_con">
                                                                <div class="list_con w_con">
                                                                        <ul>
                                                                                <?php foreach ($cooperates as $row): ?>
                                                                                <li>
                                                                                        <div class="list_div">
                                                                                                <div class="img_con">
                                                                                                        <?php if ($row['f_img']): ?>
                                                                                                        <img src="/userfiles/agency/<?= htmlspecialchars($row['f_img']) ?>" alt="협력기관 이미지" class="fx w_img" />
                                                                                                        <?php endif; ?>
                                                                                                        <?php if ($row['f_img_m']): ?>
                                                                                                        <img src="/userfiles/agency/<?= htmlspecialchars($row['f_img_m']) ?>" alt="협력기관 모바일 이미지" class="fx m_img" />
                                                                                                        <?php endif; ?>
                                                                                                </div>

                                                                                                <div class="text_con">
                                                                                                        <span><?= htmlspecialchars($row['f_name']) ?></span>
                                                                                                </div>
                                                                                        </div>
                                                                                </li>
                                                                                <?php endforeach; ?>
                                                                        </ul>
                                                                </div>

                                                                <div class="slide_con m_con">
                                                                        <div class="swiper-container introduce_sub03_info01_slide">
                                                                                <div class="swiper-wrapper">
                                                                                        <?php foreach (array_chunk($cooperates, 6) as $chunk): ?>
                                                                                        <div class="swiper-slide">
                                                                                                <ul>
                                                                                                <?php foreach ($chunk as $row): ?>
                                                                                                        <li>
                                                                                                                <div class="list_div">
                                                                                                                        <div class="img_con">
                                                                                                                                <?php if ($row['f_img']): ?>
                                                                                                                                <img src="/userfiles/agency/<?= htmlspecialchars($row['f_img']) ?>" alt="협력기관 이미지" class="fx w_img" />
                                                                                                                                <?php endif; ?>
                                                                                                                                <?php if ($row['f_img_m']): ?>
                                                                                                                                <img src="/userfiles/agency/<?= htmlspecialchars($row['f_img_m']) ?>" alt="협력기관 모바일 이미지" class="fx m_img" />
                                                                                                                                <?php endif; ?>
                                                                                                                        </div>
                                                                                                                        <div class="text_con">
                                                                                                                                <span><?= htmlspecialchars($row['f_name']) ?></span>
                                                                                                                        </div>
                                                                                                                </div>
                                                                                                        </li>
                                                                                                <?php endforeach; ?>
                                                                                                </ul>
                                                                                        </div>
                                                                                        <?php endforeach; ?>
                                                                                </div>

                                                                                <div class="swiper-pagination introduce_sub03_info01_slide_swiper-pagination"></div>
                                                                        </div>
                                                                </div>
							</div>
						</div>
					</div>

					<div class="info02_con">
						<div class="contents_con">
							<div class="title_con">
								<div class="text01_con">
									<span>
										RELATED AGENCIES
									</span>
								</div>

								<div class="text02_con">
									<span>
										관련기관
									</span>
								</div>
							</div>

                                                        <div class="contents_con">
                                                                <div class="list_con w_con">
                                                                        <ul>
                                                                                <?php foreach ($manages as $row): ?>
                                                                                <li>
                                                                                        <?php if (!empty($row['f_link'])): ?><a href="<?= htmlspecialchars($row['f_link']) ?>" target="_blank"><?php endif; ?>
                                                                                        <div class="img_con">
                                                                                                <?php if ($row['f_img']): ?>
                                                                                                <img src="/userfiles/agency/<?= htmlspecialchars($row['f_img']) ?>" alt="관련기관 이미지" class="fx w_img" />
                                                                                                <?php endif; ?>
                                                                                                <?php if ($row['f_img_m']): ?>
                                                                                                <img src="/userfiles/agency/<?= htmlspecialchars($row['f_img_m']) ?>" alt="관련기관 모바일 이미지" class="fx m_img" />
                                                                                                <?php endif; ?>
                                                                                        </div>
                                                                                        <?php if (!empty($row['f_link'])): ?></a><?php endif; ?>
                                                                                </li>
                                                                                <?php endforeach; ?>
                                                                        </ul>
                                                                </div>

                                                                <div class="slide_con m_con">
                                                                        <div class="swiper-container introduce_sub03_info01_slide">
                                                                                <div class="swiper-wrapper">
                                                                                        <?php foreach (array_chunk($manages, 3) as $chunk): ?>
                                                                                        <div class="swiper-slide">
                                                                                                <ul>
                                                                                                <?php foreach ($chunk as $row): ?>
                                                                                                        <li>
                                                                                                                <?php if (!empty($row['f_link'])): ?><a href="<?= htmlspecialchars($row['f_link']) ?>" target="_blank"><?php endif; ?>
                                                                                                                <div class="img_con">
                                                                                                                        <?php if ($row['f_img']): ?>
                                                                                                                        <img src="/userfiles/agency/<?= htmlspecialchars($row['f_img']) ?>" alt="관련기관 이미지" class="fx w_img" />
                                                                                                                        <?php endif; ?>
                                                                                                                        <?php if ($row['f_img_m']): ?>
                                                                                                                        <img src="/userfiles/agency/<?= htmlspecialchars($row['f_img_m']) ?>" alt="관련기관 모바일 이미지" class="fx m_img" />
                                                                                                                        <?php endif; ?>
                                                                                                                </div>
                                                                                                                <?php if (!empty($row['f_link'])): ?></a><?php endif; ?>
                                                                                                        </li>
                                                                                                <?php endforeach; ?>
                                                                                                </ul>
                                                                                        </div>
                                                                                        <?php endforeach; ?>
                                                                                </div>

                                                                                <div class="swiper-pagination introduce_sub03_info01_slide_swiper-pagination"></div>
                                                                        </div>
                                                                </div>
							</div>
						</div>
					</div>
				</div>

			</div>
		</div>
	</div>

	<script type="text/javascript" language="javascript">
		// 초기 화면 크기 저장
		var introduce_sub03_initialWidth = window.innerWidth;
		var introduce_sub03_isFirstLoad = true;

		// 리사이즈 예외처리
		var introduce_sub03_resizeTimer;

		// 협력기관 슬라이드
		var introduce_sub03_info01_slide = null;

		// 관련기관 슬라이드
		var introduce_sub03_info02_slide = null;

		// 화면 리사이징
		$(window).resize(function(){
			// 현재 window 너비
			var currentWidth = window.innerWidth;
			
			// 너비가 변경되지 않은 경우(스크롤, 상태바 동작) 무시
			if(currentWidth === introduce_sub03_initialWidth && !introduce_sub03_isFirstLoad) {
				return;
			}
			
			clearTimeout(introduce_sub03_resizeTimer);
			
			// 화면 너비
			if (window.innerWidth > 1024) {
				
			}else{
				// 협력기관 슬라이드 예외처리
				$(".introduce_sub03_con > .info01_con > .contents_con > .contents_con > .slide_con.m_con").css({"opacity":"0","transition":"none"});

				// 관련기관 슬라이드 예외처리
				$(".introduce_sub03_con > .info02_con > .contents_con > .contents_con > .slide_con.m_con").css({"opacity":"0","transition":"none"});
			}

			introduce_sub03_resizeTimer = setTimeout(function() {
				// 실제 리사이징이 발생한 경우에만 처리
				if(currentWidth !== introduce_sub03_initialWidth || introduce_sub03_isFirstLoad) {
					
					// 화면 너비
					if (window.innerWidth > 1024) {
						
					}else{
						// 협력기관 슬라이드 파괴
						if (introduce_sub03_info01_slide) {
							introduce_sub03_info01_slide.destroy();
							introduce_sub03_info01_slide = null;
						}

						// 협력기관 슬라이드
						introduce_sub03_info01_slide = new Swiper ('.introduce_sub03_info01_slide', {
							slidesPerView: 'auto',
							effect: 'fade',
							speed: 1500,
							loop: true,
							pagination: {
								el: ".introduce_sub03_info01_slide_swiper-pagination",
								clickable: true,
							},
							observer: true,
                            observeParents: true,
						});

						// 협력기관 슬라이드 예외처리
						$(".introduce_sub03_con > .info01_con > .contents_con > .contents_con > .slide_con.m_con").css({"opacity":"1","transition":"all 0.5s ease"});

						// 관련기관 슬라이드 파괴
						if (introduce_sub03_info02_slide) {
							introduce_sub03_info02_slide.destroy();
							introduce_sub03_info02_slide = null;
						}

						// 관련기관 슬라이드
						introduce_sub03_info02_slide = new Swiper ('.introduce_sub03_info02_slide', {
							slidesPerView: 'auto',
							effect: 'fade',
							speed: 1500,
							loop: true,
							pagination: {
								el: ".introduce_sub03_info02_slide_swiper-pagination",
								clickable: true,
							},
							observer: true,
                            observeParents: true,
						});

						// 관련기관 슬라이드 예외처리
						$(".introduce_sub03_con > .info02_con > .contents_con > .contents_con > .slide_con.m_con").css({"opacity":"1","transition":"all 0.5s ease"});
					}

					introduce_sub03_initialWidth = currentWidth;
					introduce_sub03_isFirstLoad = false;
				}
			}, 500);
		});
	</script>

<?php
	include $_SERVER['DOCUMENT_ROOT'].'/include/footer.html'; 
?>	
