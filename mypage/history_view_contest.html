<?php
$Menu = "07";
$sMenu = "07-2";

include $_SERVER['DOCUMENT_ROOT'] . '/include/header.html';

$idx = (int) ($_GET['idx'] ?? 0);
$user_id = $_SESSION['kbga_user_id'] ?? '';
$row = $db->row(
    "SELECT r.*, c.f_title
       FROM df_site_competition_registration r
       LEFT JOIN df_site_competition c ON r.f_competition_idx = c.idx
      WHERE r.idx = :idx AND r.f_user_id = :uid",
    ['idx' => $idx, 'uid' => $user_id]
);
if (!$row) {
    echo '<script>alert("잘못된 접근입니다.");history.back();</script>';
    exit;
}

function printStatus($val)
{
    switch ($val) {
        case 'ing':
            return '접수중';
        case 'done':
            return '완료';
        case 'cancle':
            return '취소';
        case 'hold':
            return '보류';
        default:
            return $val;
    }
}
function printAppType($val)
{
    switch ($val) {
        case 'P':
            return '개인';
        case 'O':
            return '단체';
        default:
            return $val;
    }
}
$pay_map = ['entry' => '접수비'];
$pay_labels = [];
if (!empty($row['f_payment_category'])) {
    $codes = explode(',', $row['f_payment_category']);
    $pay_labels = array_map(function ($c) use ($pay_map) {
        return $pay_map[$c] ?? $c;
    }, $codes);
}
$pay_value = implode(', ', $pay_labels);
?>
<div id="container">
    <div id="sub_con">
        <?php include $_SERVER['DOCUMENT_ROOT'] . '/include/sub_banner.html'; ?>
        <div class="contents_con">
            <div class="mypage_con">
                <div class="contents_con">
                    <?php include $_SERVER['DOCUMENT_ROOT'] . '/mypage/include/mypage_nav.html'; ?>
                    <div class="contents_con">
                        <div class="title_con"><span>신청이력</span></div>
                        <div class="contents_con">
                            <div class="history_view_con">
                                <div class="contents_con">
                                    <div class="exam_con">
                                        <table cellpadding="0" cellspacing="0">
                                            <thead>
                                                <tr>
                                                    <td align="center"><span>명칭</span></td>
                                                    <td align="center"><span>결과</span></td>
                                                    <td align="center"><span>날짜</span></td>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td align="center"><span><?= htmlspecialchars($row['f_title'], ENT_QUOTES) ?></span></td>
                                                    <td align="center"><span><?= printStatus($row['f_applicant_status']) ?></span></td>
                                                    <td align="center"><span><?= date('Y.m.d', strtotime($row['reg_date'])) ?></span></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="contents_con">
                                        <div class="apply_con">
                                            <div class="contents_con">
                                                <div class="write_con">
                                                    <div class="contents_con">
                                                        <div class="input_con">
                                                            <div class="form01_con">
                                                                <ul>
                                                                    <li>
                                                                        <div class="list_div fl">
                                                                            <table cellpadding="0" cellspacing="0">
                                                                                <tbody>
                                                                                    <tr>
                                                                                        <td align="left" class="title_td"><span>신청 구분</span></td>
                                                                                        <td align="left" class="info_td">
                                                                                            <input type="text" class="input" readonly value="<?= printAppType($row['f_applicant_type']) ?>" />
                                                                                        </td>
                                                                                    </tr>
                                                                                    <tr>
                                                                                        <td align="left" class="title_td"><span>참가부문</span></td>
                                                                                        <td align="left" class="info_td">
                                                                                            <input type="text" class="input" readonly value="<?= htmlspecialchars($row['f_part_title'], ENT_QUOTES) ?>" />
                                                                                        </td>
                                                                                    </tr>
                                                                                    <tr>
                                                                                        <td align="left" class="title_td"><span>종목분야</span></td>
                                                                                        <td align="left" class="info_td">
                                                                                            <input type="text" class="input" readonly value="<?= htmlspecialchars($row['f_field_title'], ENT_QUOTES) ?>" />
                                                                                        </td>
                                                                                    </tr>
                                                                                    <tr>
                                                                                        <td align="left" class="title_td"><span>참가종목</span></td>
                                                                                        <td align="left" class="info_td">
                                                                                            <input type="text" class="input" readonly value="<?= htmlspecialchars($row['f_event_title'], ENT_QUOTES) ?>" />
                                                                                        </td>
                                                                                    </tr>
                                                                                    <tr>
                                                                                        <td align="left" class="title_td"><span>이름</span></td>
                                                                                        <td align="left" class="info_td">
                                                                                            <input type="text" class="input" readonly value="<?= htmlspecialchars($row['f_user_name'], ENT_QUOTES) ?>" />
                                                                                        </td>
                                                                                    </tr>
                                                                                    <tr>
                                                                                        <td align="left" class="title_td"><span>성별</span></td>
                                                                                        <td align="left" class="info_td">
                                                                                            <input type="text" class="input" readonly value="<?= $row['f_gender'] === 'M' ? '남자' : ($row['f_gender'] === 'F' ? '여자' : '') ?>" />
                                                                                        </td>
                                                                                    </tr>
                                                                                    <tr>
                                                                                        <td align="left" class="title_td"><span>영문이름</span></td>
                                                                                        <td align="left" class="info_td">
                                                                                            <input type="text" class="input" readonly value="<?= htmlspecialchars($row['f_user_name_en'], ENT_QUOTES) ?>" />
                                                                                        </td>
                                                                                    </tr>
                                                                                    <tr>
                                                                                        <td align="left" class="title_td"><span>생년월일</span></td>
                                                                                        <td align="left" class="info_td">
                                                                                            <input type="text" class="input" readonly value="<?= htmlspecialchars($row['f_birth_date'], ENT_QUOTES) ?>" />
                                                                                        </td>
                                                                                    </tr>
                                                                                    <tr>
                                                                                        <td align="left" class="title_td"><span>연락처</span></td>
                                                                                        <td align="left" class="info_td">
                                                                                            <input type="text" class="input" readonly value="<?= htmlspecialchars($row['f_tel'], ENT_QUOTES) ?>" />
                                                                                        </td>
                                                                                    </tr>
                                                                                    <tr>
                                                                                        <td align="left" class="title_td"><span>이메일</span></td>
                                                                                        <td align="left" class="info_td">
                                                                                            <input type="text" class="input" readonly value="<?= htmlspecialchars($row['f_email'], ENT_QUOTES) ?>" />
                                                                                        </td>
                                                                                    </tr>
                                                                                    <tr>
                                                                                        <td align="left" class="title_td"><span>우편번호</span></td>
                                                                                        <td align="left" class="info_td">
                                                                                            <input type="text" class="input" readonly value="<?= htmlspecialchars($row['f_zip'], ENT_QUOTES) ?>" />
                                                                                        </td>
                                                                                    </tr>
                                                                                    <tr>
                                                                                        <td align="left" class="title_td"><span>기본주소</span></td>
                                                                                        <td align="left" class="info_td">
                                                                                            <input type="text" class="input" readonly value="<?= htmlspecialchars($row['f_address1'], ENT_QUOTES) ?>" />
                                                                                        </td>
                                                                                    </tr>
                                                                                    <tr>
                                                                                        <td align="left" class="title_td"><span>상세주소</span></td>
                                                                                        <td align="left" class="info_td">
                                                                                            <input type="text" class="input" readonly value="<?= htmlspecialchars($row['f_address2'], ENT_QUOTES) ?>" />
                                                                                        </td>
                                                                                    </tr>
                                                                                    <tr>
                                                                                        <td align="left" class="title_td"><span>입금자명</span></td>
                                                                                        <td align="left" class="info_td">
                                                                                            <input type="text" class="input" readonly value="<?= htmlspecialchars($row['f_payer_name'], ENT_QUOTES) ?>" />
                                                                                        </td>
                                                                                    </tr>
                                                                                    <tr>
                                                                                        <td align="left" class="title_td"><span>은행</span></td>
                                                                                        <td align="left" class="info_td">
                                                                                            <input type="text" class="input" readonly value="<?= htmlspecialchars($row['f_payer_bank'], ENT_QUOTES) ?>" />
                                                                                        </td>
                                                                                    </tr>
                                                                                    <tr>
                                                                                        <td align="left" class="title_td"><span>입금구분</span></td>
                                                                                        <td align="left" class="info_td">
                                                                                            <input type="text" class="input" readonly value="<?= htmlspecialchars($pay_value, ENT_QUOTES) ?>" />
                                                                                        </td>
                                                                                    </tr>
                                                                                </tbody>
                                                                            </table>
                                                                        </div>
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="btn_con">
                                            <a href="/mypage/history.html" class="a_btn">목록</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<?php include $_SERVER['DOCUMENT_ROOT'] . '/include/footer.html'; ?>
